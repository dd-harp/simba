---
title: "The `macdonald` Module"
---

The module called `macdonald` in `ramp.xds` was included for several reasons. 

+ It implements a version of Macdonald's model, attributable to Aron & May [@AronJL1982PopulationDynamics]

## The `macdonald` Module

The module called `macdonald` has been extended beyond the Aron & May formulation to include spatial dynamics and parity. To formulate the spatial model, a spatial domain is sub-divided into a set of patches. Variable and parameter names do not change, but they can now represent vectors of length $n_p.$ To formulate the *demographic matrix,* denoted $\Omega,$ that describes mosquito mortality, emigration, and other loss from the system. We let $\sigma$ denote the emigration rate and $\cal K$ the mosquito dispersal matrix. We also introduce a parameter, $\mu$ to model the fraction of mosquitoes that are lost to emigration from each patch. $$\Omega = \mbox{diag} \left(g\right) + \left(\mbox{diag} \left(1-\mu\right)  - \cal K\right) \cdot \mbox{diag} \left(\sigma\right) 
$$

### Dynamics

$$\begin{array}{rl}
\dot{M} & = \Lambda - \Omega\cdot M  \\
\dot{P} & = \mbox{diag}(f) \cdot (M-P) -  \Omega \cdot P\\ 
\dot{Y} & = \mbox{diag}(fq\kappa) \cdot (M-Y) - \Omega \cdot Y \\
\dot{Z} & = 
\dot{Z} = e^{-\Omega \tau} \cdot \mbox{diag}(fq\kappa_{t-\tau}) \cdot (M_{t-\tau}-Y_{t-\tau}) - \Omega \cdot Z
\end{array}
$$

## Ordinary Differential Equations

We note that the module `SI` provides a reasonably simple approximating model that has no delay, but in computing $fqZ,$ it includes mortality and dispersal that would have occurred during the EIP: $$
Z = e^{-\Omega \tau} \cdot Y 
$$ The implementation of `SI` is similar in spirit to the simple model presented in Smith & McKenzie (2004)[^5]. in that mortality and dispersal over the EIP is accounted for, but the time lag is not. While transient dynamics of the ODE model will not equal the DDE model, they have the same equilibrium values, and so for numerical work requiring finding equilibrium points, the faster ODE model can be safely substituted.

[^5]: Smith, D.L., Ellis McKenzie, F. Statics and dynamics of malaria infection in Anopheles mosquitoes. Malar J 3, 13 (2004). [online](https://doi.org/10.1186/1475-2875-3-13){target="_blank"}

## Steady States

There are two logical ways to begin solving the non-trivial equilibrium. The first assumes $\Lambda$ is known, which implies good knowledge of mosquito ecology. The second assumes $Z$ is known, which implies knowledge of the biting rate on the human population. We show both below.

### Starting with $\Lambda$

Given $\Lambda$ we can solve:

$$
M = \Omega^{-1} \cdot \Lambda
$$ Then given $M$ we set $\dot{Y}$ to zero and factor out $Y$ to get:

$$
Y = (\mbox{diag}(fq\kappa) + \Omega)^{-1} \cdot \mbox{diag}(fq\kappa) \cdot M
$$ We set $\dot{Z}$ to zero to get:

$$
Z = \Omega^{-1} \cdot e^{-\Omega \tau} \cdot \mbox{diag}(fq\kappa) \cdot (M-Y)
$$

Because the dynamics of $P$ are independent of the infection dynamics, we can solve it given $M$ as:

$$
P = (\Omega + \mbox{diag}(f))^{-1} \cdot \mbox{diag}(f) \cdot M
$$

### Starting with $Z$

It is more common that we start from an estimate of $Z$, perhaps derived from an estimated EIR (entomological inoculation rate). Given $Z$, we can calculate the other state variables and $\Lambda$. For numerical implementation, note that $(e^{-\Omega\tau})^{-1} = e^{\Omega\tau}$.

$$
M-Y = \mbox{diag}(1/fq\kappa) \cdot (e^{-\Omega\tau})^{-1} \cdot \Omega \cdot Z
$$

$$
Y = \Omega^{-1} \cdot \mbox{diag}(fq\kappa) \cdot (M-Y)
$$

$$
M = (M - Y) + Y
$$

$$
\Lambda = \Omega \cdot M
$$ We can use the same equation for $P$ as above.
